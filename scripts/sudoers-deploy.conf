# ROKO Marketing Deployment - Service Management
# Allows roctinam to manage deployment service without password

# Service management commands
roctinam ALL=(ALL) NOPASSWD: /usr/bin/systemctl start roko-deploy-watcher
roctinam ALL=(ALL) NOPASSWD: /usr/bin/systemctl stop roko-deploy-watcher
roctinam ALL=(ALL) NOPASSWD: /usr/bin/systemctl restart roko-deploy-watcher
roctinam ALL=(ALL) NOPASSWD: /usr/bin/systemctl reload roko-deploy-watcher
roctinam ALL=(ALL) NOPASSWD: /usr/bin/systemctl status roko-deploy-watcher
roctinam ALL=(ALL) NOPASSWD: /usr/bin/systemctl reset-failed roko-deploy-watcher
roctinam ALL=(ALL) NOPASSWD: /usr/bin/systemctl daemon-reload
roctinam ALL=(ALL) NOPASSWD: /usr/bin/systemctl is-active roko-deploy-watcher
roctinam ALL=(ALL) NOPASSWD: /usr/bin/journalctl -u roko-deploy-watcher *
roctinam ALL=(ALL) NOPASSWD: /usr/bin/journalctl -xeu roko-deploy-watcher *

# Process management for stuck npm/node processes
roctinam ALL=(ALL) NOPASSWD: /usr/bin/killall npm
roctinam ALL=(ALL) NOPASSWD: /usr/bin/killall node
roctinam ALL=(ALL) NOPASSWD: /usr/bin/killall npm ci
roctinam ALL=(ALL) NOPASSWD: /usr/bin/kill -9 *

# File operations for deployment
roctinam ALL=(ALL) NOPASSWD: /usr/bin/tee /var/lib/roko-marketing/deploy-config
roctinam ALL=(ALL) NOPASSWD: /usr/bin/tee /var/lib/roko-marketing/last-deployed-sha
roctinam ALL=(ALL) NOPASSWD: /usr/bin/tee /etc/systemd/system/roko-deploy-watcher.service.d/branch.conf
roctinam ALL=(ALL) NOPASSWD: /usr/bin/sed -i * /etc/systemd/system/roko-deploy-watcher.service

# Directory operations
roctinam ALL=(ALL) NOPASSWD: /usr/bin/mkdir -p /var/lib/roko-marketing
roctinam ALL=(ALL) NOPASSWD: /usr/bin/mkdir -p /var/backups/roko-marketing
roctinam ALL=(ALL) NOPASSWD: /usr/bin/mkdir -p /etc/systemd/system/roko-deploy-watcher.service.d
roctinam ALL=(ALL) NOPASSWD: /usr/bin/chown -R roctinam\:roctinam /var/lib/roko-marketing
roctinam ALL=(ALL) NOPASSWD: /usr/bin/chown -R roctinam\:roctinam /var/backups/roko-marketing
roctinam ALL=(ALL) NOPASSWD: /usr/bin/rm -f /var/backups/roko-marketing/*

# Backup operations
roctinam ALL=(ALL) NOPASSWD: /usr/bin/tar -czf /var/backups/roko-marketing/* *
roctinam ALL=(ALL) NOPASSWD: /usr/bin/tar -xzf /var/backups/roko-marketing/* *
roctinam ALL=(ALL) NOPASSWD: /usr/bin/tar *